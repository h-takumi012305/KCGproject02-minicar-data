<!DOCTYPE html>
<html lang="ja">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Poprace</title>
 <link rel="stylesheet" href="styles.css">
 <script>
 let deleteQueue = [];

 function queueDelete(id) {
 
 deleteQueue.push(id);
 }

 function updateHave(id, increment) {
 fetch('/src/popraceIncrement.php', {
 method: 'POST',
 headers: {
 'Content-Type': 'application/x-www-form-urlencoded',
 },
 body: `id=${id}&increment=${increment}`
 }).then(response => {
 if (response.ok) {
 location.reload();
 } else {
 alert('Failed to update');
 }
 });
 }

 function executeDeletes() {
 if (confirm('本当に削除しますか？')) {
 deleteQueue.forEach(id => {
 fetch('src/popracedelete.php', {
 method: 'POST',
 headers: {
 'Content-Type': 'application/x-www-form-urlencoded',
 },
 body: `id=${id}&_method=DELETE`
 }).then(response => {
 if (!response.ok) {
 alert('Failed to delete');
 }
 });
 });
 location.reload();  // Reload the page after all deletes
 }
 }
 </script>
 </head>
 <body>
 <p><input type="image" src="./../images/poprace-logo.png" /></p>
 <h1>Poprace</h1>
 <h2><a href="../minicardata-base.html">ミニカーデータベースへ戻る</a></h2>
 <form method="GET" action="">
 <input type="text" name="search" placeholder="Search...">
 <button type="submit">Search</button>
 </form>

 <table>
 <tr>
 <th><a href="?sort=ID">ID</a></th>
 <th><a href="?sort=itemID">itemID</a></th>
 <th><a href="?sort=Name">Name</a></th>
 <th><a href="?sort=Description">Description</a></th>
 <th><a href="?sort=Make">Make</a></th>
 <th><a href="?sort=DATE">DATE</a></th>
 <th><a href="?sort=Manufacturer">Manufacturer</a></th>
 <th><a href="?sort=have">have</a></th>
 <th>Update</th>
 <th><button type="button" onclick="executeDeletes()">削除</button></th>
 </tr>
 <?php $__currentLoopData = $posts; $this->addLoop($__currentLoopData);$this->getFirstLoop();
 foreach($__currentLoopData as $post): $loop = $this->incrementLoopIndices();  ?>
 <tr>
 <td><?php echo \htmlentities($post['ID']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['itemID']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['Name']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['Description']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['Make']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['DATE']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['Manufacturer']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td><?php echo \htmlentities($post['have']??'', ENT_QUOTES, 'UTF-8', false); ?></td>
 <td>
 <button type="button" onclick="updateHave(<?php echo \htmlentities($post['ID']??'', ENT_QUOTES, 'UTF-8', false); ?>, 1)">+</button>
 <button type="button" onclick="updateHave(<?php echo \htmlentities($post['ID']??'', ENT_QUOTES, 'UTF-8', false); ?>, -1)">-</button>
 </td>
 <td>
 <input type="checkbox" onclick="queueDelete(<?php echo \htmlentities($post['ID']??'', ENT_QUOTES, 'UTF-8', false); ?>)">
 </td>
 
 </tr>
 <?php endforeach; $this->popLoop(); $loop = $this->getFirstLoop(); ?>
 </table>
 <!-- Form for adding new data -->
 <form method="POST" action="src/popraceadd.php">
 <input type="text" name="ID" placeholder="ID" required>
 <input type="text" name="itemID" placeholder="itemID" required>
 <input type="text" name="Name" placeholder="Name" required>
 <input type="text" name="Description" placeholder="Description" required>
 <input type="text" name="Make" placeholder="Make" required>
 <input type="date" name="DATE" placeholder="DATE" required>
 <input type="text" name="Manufacturer" placeholder="Manufacturer" required>
 <input type="number" name="have" placeholder="have" required>
 <button type="submit">Add</button>
 </form>
</body>
</html>
